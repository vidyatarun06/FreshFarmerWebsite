<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∞ï‡±ç‡∞≤‡∞Ø‡∞ø‡∞Ç‡∞ü‡±ç ‡∞™‡±ç‡∞∞‡±ä‡∞´‡±à‡∞≤‡±ç</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg bg-success">
        <div class="container">
            <a class="navbar-brand text-white fw-bold" href="index.html">üåæ FreshFarmer</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a id="home-link" class="nav-link text-white" href="index.html">‡∞π‡±ã‡∞Æ‡±ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="farmer-login.html">‡∞∞‡±à‡∞§‡±Å ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="client-login.html">‡∞ï‡±ç‡∞≤‡∞Ø‡∞ø‡∞Ç‡∞ü‡±ç ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="register.html">‡∞∞‡∞ø‡∞ú‡∞ø‡∞∏‡±ç‡∞ü‡∞∞‡±ç</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="client-products.html">‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡±Å‡∞≤‡±Å</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white" href="#" onclick="logout()">‡∞≤‡∞æ‡∞ó‡±ç‡∞Ö‡∞µ‡±Å‡∞ü‡±ç</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2 class="text-center">‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡±ä‡∞´‡±à‡∞≤‡±ç</h2>
        <div class="card">
            <p><strong>‡∞Ø‡±Ç‡∞ú‡∞∞‡±ç ‡∞®‡±á‡∞Æ‡±ç:</strong> <span id="username"></span></p>
            <p><strong>‡∞∞‡±ã‡∞≤‡±ç:</strong> <span id="role"></span></p>
        </div>

        <h3 class="text-center mt-4">‡∞Æ‡±Ä ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≤‡±Å ‡∞∏‡∞æ‡∞∞‡∞æ‡∞Ç‡∞∂‡∞Ç</h3>
        <div id="summary-loading" class="loader"></div>
        <div id="summary-content" class="summary-card" style="display: none;">
            <p><strong>‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≥‡±ç‡∞≤‡±Å:</strong> <span id="total-purchases">0</span> ‡∞â‡∞§‡±ç‡∞™‡∞§‡±ç‡∞§‡±Å‡∞≤‡±Å</p>
            <p><strong>‡∞Æ‡±ä‡∞§‡±ç‡∞§‡∞Ç ‡∞ñ‡∞∞‡±ç‡∞ö‡±Å:</strong> ‚Çπ<span id="total-spent">0</span></p>
            <div class="text-center mt-3">
                <a href="client-products.html" class="btn btn-primary">‡∞ï‡±ä‡∞®‡±Å‡∞ó‡±ã‡∞≥‡±ç‡∞≤‡±Å ‡∞ö‡±Ç‡∞°‡∞Ç‡∞°‡∞ø</a>
            </div>
        </div>
    </div>

    <script src="bootstrap.bundle.min.js"></script>
    <script>
        function logout() {
            const user = JSON.parse(localStorage.getItem("currentUser"));
            localStorage.removeItem("currentUser");
            window.location.href = user.role === "farmer" ? "farmer-login.html" : "client-login.html";
        }

        // Check if user is logged in
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        if (currentUser) {
            document.getElementById("username").textContent = currentUser.username;
            document.getElementById("role").textContent = currentUser.role === "client" ? "‡∞ï‡±ç‡∞≤‡∞Ø‡∞ø‡∞Ç‡∞ü‡±ç" : "‡∞∞‡±à‡∞§‡±Å";
        } else {
            alert("‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞≤‡∞æ‡∞ó‡∞ø‡∞®‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø!");
            window.location.href = "client-login.html";
        }

        // Fetch purchase summary
        async function loadPurchaseSummary() {
            const summaryLoading = document.getElementById("summary-loading");
            const summaryContent = document.getElementById("summary-content");

            const response = await fetch(`http://localhost:8001/client-purchases/${currentUser.username}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                }
            });

            summaryLoading.style.display = "none";
            summaryContent.style.display = "block";

            if (response.status === 404) {
                document.getElementById("total-purchases").textContent = "0";
                document.getElementById("total-spent").textContent = "0";
                return;
            }

            const purchases = await response.json();
            const totalPurchases = purchases.length;
            const totalSpent = purchases.reduce((sum, purchase) => sum + (purchase.quantity * purchase.price_per_kg), 0);

            document.getElementById("total-purchases").textContent = totalPurchases;
            document.getElementById("total-spent").textContent = totalSpent.toFixed(2);
        }

        // Load summary on page load
        window.onload = loadPurchaseSummary;
    </script>
</body>
</html>